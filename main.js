window.addEventListener("DOMContentLoaded",(()=>{const e=[document.querySelector(".fill__body-block")],t=[];async function n(){let e;return await fetch("http://localhost:3000/bd").then((e=>e.json())).then((e=>Object.entries(e))).then((t=>e=t)),e}!function(){const e=document.querySelector(".start__wrap"),t=document.querySelector(".fill"),n=document.querySelector(".block_horizontal"),a=document.querySelector(".block_vertical"),o=document.querySelector(".start__supply");e.addEventListener("click",(()=>{t.classList.toggle("fill_action"),n.classList.toggle("block_horizontal_action"),a.classList.toggle("block_vertical_action"),setTimeout((function(){t.classList.toggle("fill_addblock")}),500),"Подать заявку"==o.textContent?o.textContent="Скрыть":o.textContent="Подать заявку"}))}(),function(){const t=document.querySelector(".fill__body");document.querySelector(".add").addEventListener("click",(n=>{const a=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),r=document.createElement("input"),i=document.createElement("input"),m=document.createElement("input"),p=document.createElement("input");a.classList.add("fill__body-block"),o.classList.add("fill__body-number"),l.classList.add("fill__body-descr"),c.classList.add("fill__body-count"),d.classList.add("fill__body-department"),s.classList.add("fill__body-object"),r.classList.add("fill__descr-input"),i.classList.add("fill__count-input"),m.classList.add("fill__department-input"),p.classList.add("fill__object-input"),o.textContent=e.length+1,l.append(r),c.append(i),d.append(m),s.append(p),a.append(o),a.append(l),a.append(c),a.append(d),a.append(s),e.push(a),t.append(a)}))}(),n().then((e=>e.forEach(((e,n)=>{if(e[1].closeApplication){const n=document.querySelector(".closeapp");document.createElement("div").classList.add("agreement__wrap");const a=document.createElement("div");a.classList.add("app__number"),a.textContent=+e[0],n.append(a);const o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div");o.classList.add("agreement__header"),l.classList.add("agreement__header-number"),c.classList.add("agreement__header-descr"),d.classList.add("agreement__header-count"),s.classList.add("agreement__header-department"),r.classList.add("agreement__header-object"),l.textContent="№",c.textContent="Описание работ",d.textContent="Кол-во",s.textContent="Отдел",r.textContent="Объект",o.append(l,c,d,s,r),n.append(o),Object.entries(e[1].application).forEach(((e,a)=>{const o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div");o.classList.add("agreement__body"),l.classList.add("agreement__body-number"),c.classList.add("agreement__body-descr"),d.classList.add("agreement__body-count"),s.classList.add("agreement__body-department"),r.classList.add("agreement__body-object"),l.textContent=+e[0]+1,c.textContent=e[1].descr,d.textContent=e[1].count,s.textContent=e[1].department,r.textContent=e[1].object,o.append(l,c,d,s,r),n.append(o),t.push(n)}))}else{if(!e[1].GI&&!e[1].closeApplication){const n=document.querySelector(".agreement"),a=document.createElement("div");a.classList.add("agreement__wrap");const o=document.createElement("div");o.classList.add("app__number"),o.textContent=+e[0],a.append(o);const l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div");if(l.classList.add("agreement__header"),c.classList.add("agreement__header-number"),d.classList.add("agreement__header-descr"),s.classList.add("agreement__header-count"),r.classList.add("agreement__header-department"),i.classList.add("agreement__header-object"),c.textContent="№",d.textContent="Описание работ",s.textContent="Кол-во",r.textContent="Отдел",i.textContent="Объект",l.append(c,d,s,r,i),a.append(l),"mainIngeneer"==e[0]||"mainMechanic"==e[0]||"technicalHead"==e[0]||"headMechanization"==e[0]);else{Object.entries(e[1].application).forEach(((e,t)=>{const n=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div");n.classList.add("agreement__body"),o.classList.add("agreement__body-number"),l.classList.add("agreement__body-descr"),c.classList.add("agreement__body-count"),d.classList.add("agreement__body-department"),s.classList.add("agreement__body-object"),o.textContent=+e[0]+1,l.textContent=e[1].descr,c.textContent=e[1].count,d.textContent=e[1].department,s.textContent=e[1].object,n.append(o,l,c,d,s),a.append(n)}));const o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("h3"),d=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),m=document.createElement("div"),p=document.createElement("div"),u=document.createElement("input"),_=document.createElement("input"),y=document.createElement("input"),v=document.createElement("button"),g=document.createElement("button"),b=document.createElement("button"),E=document.createElement("img"),k=document.createElement("img"),L=document.createElement("img"),h=document.createElement("div"),f=document.createElement("h3"),x=document.createElement("div"),C=document.createElement("div"),S=document.createElement("input"),q=document.createElement("button");o.classList.add("agreement__confirmation"),l.classList.add("agreement__confirmation-aligner"),c.classList.add("title"),d.classList.add("agreement__aligner-block"),s.classList.add("agreement__aligner-block"),r.classList.add("agreement__aligner-block"),i.classList.add("agreement__aligner-name"),m.classList.add("agreement__aligner-name"),p.classList.add("agreement__aligner-name"),u.classList.add("agreement__aligner-input"),_.classList.add("agreement__aligner-input"),y.classList.add("agreement__aligner-input"),v.classList.add("align__btn"),g.classList.add("align__btn"),b.classList.add("align__btn"),E.classList.add("align__img"),k.classList.add("align__img"),L.classList.add("align__img"),h.classList.add("agreement__confirmation-approver"),f.classList.add("title"),x.classList.add("agreement__approver-block"),C.classList.add("agreement__approver-name"),S.classList.add("agreement__approver-input"),q.classList.add("approve__btn"),S.type="checkbox",f.textContent="Утверждено",C.textContent="Главный инженер",q.textContent="Утвердить",u.type="checkbox",_.type="checkbox",y.type="checkbox",c.textContent="Согласовано",v.textContent="Согласовать",g.textContent="Согласовать",b.textContent="Согласовать",i.textContent="Зам. нач. по механизации ВТПК",m.textContent="Главный механик",p.textContent="Начальник техотдела",E.src="./icons/9041708_check_icon.png",k.src="./icons/9041708_check_icon.png",L.src="./icons/9041708_check_icon.png",e[1].TO?r.append(p,L):r.append(p,y,b),e[1].ZNM?d.append(i,E):d.append(i,u,v),e[1].GM?s.append(m,k):s.append(m,_,g),l.append(c,d,s,r),o.append(l),o.append(h),x.append(C,S,q),h.append(f,x);const j=document.createElement("div"),O=document.createElement("div"),w=document.createElement("div"),T=document.createElement("div"),A=document.createElement("div"),N=document.createElement("div"),I=document.createElement("div");j.classList.add("agreement__date"),O.classList.add("agreement__date-block"),w.classList.add("agreement__date-block"),T.classList.add("agreement__date-name"),N.classList.add("agreement__date-name"),A.classList.add("agreement__date-value"),I.classList.add("agreement__date-value"),T.textContent="Дата подачи:",A.textContent=e[1].dateSupply,N.textContent="Дата утверждения:",I.textContent=e[1].dateApprove,O.append(T,A),w.append(N,I),j.append(O,w),a.append(o),a.append(j),t.push(a),n.append(a)}}if(e[1].GI&&!e[1].closeApplication){const n=document.querySelector(".work"),a=document.createElement("div");a.classList.add("wrap__work");const o=document.createElement("div");o.classList.add("app__number"),o.textContent=+e[0],a.append(o);const l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div");l.classList.add("agreement__header"),c.classList.add("agreement__header-number"),d.classList.add("agreement__header-descr"),s.classList.add("agreement__header-count"),r.classList.add("agreement__header-department"),i.classList.add("agreement__header-object"),c.textContent="№",d.textContent="Описание работ",s.textContent="Кол-во",r.textContent="Отдел",i.textContent="Объект",l.append(c,d,s,r,i),a.append(l),Object.entries(e[1].application).forEach(((e,t)=>{const n=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div");n.classList.add("agreement__body"),o.classList.add("agreement__body-number"),l.classList.add("agreement__body-descr"),c.classList.add("agreement__body-count"),d.classList.add("agreement__body-department"),s.classList.add("agreement__body-object"),o.textContent=+e[0]+1,l.textContent=e[1].descr,c.textContent=e[1].count,d.textContent=e[1].department,s.textContent=e[1].object,n.append(o,l,c,d,s),a.append(n)}));const m=document.createElement("div"),p=document.createElement("div"),u=document.createElement("div"),_=document.createElement("div"),y=document.createElement("div"),v=document.createElement("div"),g=document.createElement("div");m.classList.add("agreement__date"),p.classList.add("agreement__date-block"),u.classList.add("agreement__date-block"),_.classList.add("agreement__date-name"),v.classList.add("agreement__date-name"),y.classList.add("agreement__date-value"),g.classList.add("agreement__date-value"),_.textContent="Дата подачи:",y.textContent=e[1].dateSupply,v.textContent="Дата утверждения:",g.textContent=e[1].dateApprove,p.append(_,y),u.append(v,g),m.append(p,u);const b=document.createElement("div"),E=document.createElement("button");b.classList.add("agreement__close-work"),E.classList.add("agreement__close-btn"),E.textContent="Закрыть заявку",b.append(E),a.append(m),a.append(b),n.append(a),t.push(a)}}})))),function(){const t=document.querySelector(".apply");let a,o,l={},c={},d=new Date,s=d.getDate(),r=d.getMonth()+1,i=d.getFullYear();s<10&&(s="0"+s),r<10&&(r="0"+r),t.addEventListener("click",(t=>{n().then((e=>a=e)),setTimeout((function(){console.log(a[0])}),2e3),e.forEach(((e,t)=>{l[t]={descr:e.querySelector(".fill__descr-input").value,count:e.querySelector(".fill__count-input").value,department:e.querySelector(".fill__department-input").value,object:e.querySelector(".fill__object-input").value,note:{}}})),setTimeout((function(){a.forEach((e=>{console.log(e)})),console.log(a)}),3e3),c.application=l,c.GI=!1,c.TO=!1,c.ZNM=!1,c.GM=!1,c.dateSupply=`${s}.${r}.${i}`,c.dateApprove="XX.XX.XXXX",c.closeApplication=!1,setTimeout((function(){o=[`${a.length}`,c],a.push(o),fetch("http://localhost:3000/bd",{method:"POST",body:JSON.stringify(Object.fromEntries(a)),headers:{"Content-type":"application/json"}}),location.reload()}),2e3)}))}(),function(){const e=document.querySelector(".agreement");e.addEventListener("click",(t=>{setTimeout((function(){confirmCheckboxes=e.querySelectorAll(".agreement__aligner-input"),confirmBtns=e.querySelectorAll(".align__btn"),approveBtns=e.querySelectorAll(".approve__btn"),approveCheckboxes=e.querySelectorAll(".agreement__approver-input"),confirmCheckboxes.forEach(((e,n)=>{t.target==e&&confirmBtns[n].classList.toggle("align__btn_active")})),approveCheckboxes.forEach(((e,n)=>{t.target==e&&approveBtns[n].classList.toggle("approve__btn_active")}))}),500)}))}(),setTimeout((function(){const e=document.querySelector(".agreement"),a=e.querySelectorAll(".align__btn"),o=e.querySelectorAll(".approve__btn");let l,c=new Date,d=c.getDate(),s=c.getMonth()+1,r=c.getFullYear();d<10&&(d="0"+d),s<10&&(s="0"+s),e.addEventListener("click",(e=>{a.forEach((a=>{e.target==a&&t.forEach(((t,o)=>{t==a.parentNode.parentNode.parentNode.parentNode&&(n().then((e=>l=e)),setTimeout((function(){l.forEach((t=>{t[0]==`${o+4}`&&("Зам. нач. по механизации ВТПК"==e.target.previousElementSibling.previousElementSibling.textContent&&(t[1].ZNM=!0),"Главный механик"==e.target.previousElementSibling.previousElementSibling.textContent&&(t[1].GM=!0),"Начальник техотдела"==e.target.previousElementSibling.previousElementSibling.textContent&&(t[1].TO=!0))})),fetch("http://localhost:3000/bd",{method:"POST",body:JSON.stringify(Object.fromEntries(l)),headers:{"Content-type":"application/json"}}),location.reload()}),400))}))})),o.forEach((a=>{e.target==a&&t.forEach(((e,t)=>{e==a.parentNode.parentNode.parentNode.parentNode&&(n().then((e=>l=e)),setTimeout((function(){l.forEach((e=>{e[0]==`${t+4}`&&(e[1].GI=!0,e[1].dateApprove=`${d}.${s}.${r}`),console.log(e)})),fetch("http://localhost:3000/bd",{method:"POST",body:JSON.stringify(Object.fromEntries(l)),headers:{"Content-type":"application/json"}}),location.reload()}),400))}))}))}))}),400),function(){let e=document.querySelector("#login"),t=document.querySelector("#password"),n=document.querySelector("#enter"),a=document.querySelector(".user__block"),o=document.querySelector(".user__name"),l=document.querySelector(".enter"),c=document.querySelector(".start"),d=document.querySelector(".agreement"),s=document.querySelector(".work"),r=document.querySelector(".closeapp"),i=document.querySelector(".nav");n.addEventListener("click",(()=>{"kolmykovva"==e.value&&"kolmykovva"==t.value&&(o.textContent="Колмыков В.А.",a.style.display="block",l.style.display="none",c.style.display="block",d.style.display="block",s.style.display="block",r.style.display="block",i.style.display="flex"),"kovalevmv"==e.value&&"kovalevmv"==t.value&&(o.textContent="Ковалев М.В.",a.style.display="block",l.style.display="none",c.style.display="block",d.style.display="block",s.style.display="block",r.style.display="block",i.style.display="flex"),"sapunovev"==e.value&&"sapunovev"==t.value&&(o.textContent="Сапунов Е.В.",a.style.display="block",l.style.display="none",c.style.display="block",d.style.display="block",s.style.display="block",r.style.display="block",i.style.display="flex"),"ponikarovvi"==e.value&&"ponikarovvi"==t.value&&(o.textContent="Поникаров В.И.",a.style.display="block",l.style.display="none",c.style.display="block",d.style.display="block",s.style.display="block",r.style.display="block",i.style.display="flex"),localStorage.setItem("login",e.value),localStorage.setItem("password",t.value),location.reload()}))}(),function(){const e=document.querySelector(".user__btn"),t=document.querySelector(".user__block"),n=document.querySelector(".nav");e.addEventListener("click",(()=>{t.style.display="none",n.style.display="none",localStorage.clear(),location.reload()}))}(),function(){const e=document.querySelector(".user__block"),t=document.querySelector(".user__name"),n=document.querySelector(".enter"),a=document.querySelector(".start"),o=document.querySelector(".agreement"),l=document.querySelector(".work"),c=document.querySelector(".closeapp"),d=document.querySelector(".nav");if(localStorage.getItem("login")){let s=localStorage.getItem("login"),r=localStorage.getItem("password");"kolmykovva"==s&&"kolmykovva"==r&&(t.textContent="Колмыков В.А.",e.style.display="block",n.style.display="none",a.style.display="block",o.style.display="block",l.style.display="block",c.style.display="block",d.style.display="flex"),"kovalevmv"==s&&"kovalevmv"==r&&(t.textContent="Ковалев М.В.",e.style.display="block",n.style.display="none",a.style.display="block",o.style.display="block",l.style.display="block",c.style.display="block",d.style.display="flex"),"sapunovev"==s&&"sapunovev"==r&&(t.textContent="Сапунов Е.В.",e.style.display="block",n.style.display="none",a.style.display="block",o.style.display="block",l.style.display="block",c.style.display="block",d.style.display="flex"),"ponikarovvi"==s&&"ponikarovvi"==r&&(t.textContent="Поникаров В.И.",e.style.display="block",n.style.display="none",a.style.display="block",o.style.display="block",l.style.display="block",c.style.display="block",d.style.display="flex")}}(),setTimeout((function(){const e=document.querySelectorAll(".agreement__aligner-input"),t=document.querySelectorAll(".agreement__approver-input");if(localStorage.getItem("login")){let n=localStorage.getItem("login"),a=localStorage.getItem("password");console.log(n,a),"kolmykovva"==n&&"kolmykovva"==a&&t.forEach((e=>{"Главный инженер"==e.previousSibling.textContent&&(e.style.display="block")})),"kovalevmv"==n&&"kovalevmv"==a&&e.forEach((e=>{"Начальник техотдела"==e.previousSibling.textContent&&(e.style.display="block")})),"ponikarovvi"==n&&"ponikarovvi"==a&&e.forEach((e=>{"Зам. нач. по механизации ВТПК"==e.previousSibling.textContent&&(e.style.display="block")})),"sapunovev"==n&&"sapunovev"==a&&e.forEach((e=>{"Главный механик"==e.previousSibling.textContent&&(e.style.display="block")}))}}),1e3),function(){let e=[];document.querySelector(".work").addEventListener("click",(a=>{t.forEach(((t,o)=>{t.lastChild.lastChild==a.target&&(n().then((t=>e=t)),setTimeout((()=>{t.firstChild.textContent==e[o][0]&&(e[o][1].closeApplication=!0)}),1500))})),setTimeout((()=>{fetch("http://localhost:3000/bd",{method:"POST",body:JSON.stringify(Object.fromEntries(e)),headers:{"Content-type":"application/json"}}),location.reload()}),1500)}))}(),setTimeout((()=>{console.log(t)}),3e3)}));